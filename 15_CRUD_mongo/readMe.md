### mongoose.connect CONFIGS

mongoose.connect(process.env.DB_CONNECTION, {
useUnifiedTopology: true,
useNewUrlParser: true,
useCreateIndex: true,
useFindAndModify:false
},
(err) => console.log(err));

# useUnifiedTopology

Mongoose 5.7 использует драйвер MongoDB 3.3.x, который представил существенный рефакторинг того, как он обрабатывает мониторинг всех серверов в наборе реплик или изолированном кластере. На языке MongoDB это называется обнаружением и мониторингом сервера .

# удаляет поддержку для нескольких вариантов подключения , которые больше не актуальны с новой топологией двигателя

useUnifiedTopology - False по умолчанию. Установите значение true, чтобы включить использование нового механизма управления соединениями драйвера MongoDB. Вам следует установить для этого параметра значение true, за исключением маловероятного случая, когда он не позволяет поддерживать стабильное соединение..
Чтобы выбрать использование нового механизма топологии, используйте следующую строку
useUnifiedTopology: true,

# useNewUrlParser

useNewUrlParser - Базовый драйвер MongoDB устарел для своего текущего анализатора строки соединения. Поскольку это серьезное изменение, они добавили флаг useNewUrlParser, чтобы пользователи могли вернуться к старому анализатору, если обнаружат ошибку в новом анализаторе. Вы должны установить useNewUrlParser: true, если это не мешает вам подключиться. Обратите внимание, что если вы укажете useNewUrlParser: true, вы должны указать порт в строке подключения, например, 'mongodb://localhost:27017/' dbname. Новый анализатор URL не поддерживает строки подключения, у которых нет порта, например, 'mongodb://localhost/dbname'.

# useCreateIndex

useCreateIndex- 'false' по умолчанию. Установите значение true, чтобы при построении индекса Mongoose по умолчанию использовать createIndex () вместо sureIndex (), чтобы избежать предупреждений об устаревании от драйвера MongoDB.

# useFindAndModify

useFindAndModify - true по умолчанию. Установите значение false, чтобы findOneAndUpdate () и findOneAndRemove () использовали встроенную функцию findOneAndUpdate () вместо findAndModify ().

# autoIndex

autoIndex - по умолчанию mongoose будет автоматически создавать индексы, определенные в вашей схеме при подключении. Это отлично подходит для разработки, но не идеально для крупных производственных развертываний, поскольку построения индекса могут привести к снижению производительности. Если для autoIndex задано значение false, mongoose не будет автоматически создавать индексы для любой модели, связанной с этим соединением.

# Агрегация

Агрегация – это группировка значений многих документов. Операции агрегирования позволяют манипулировать такими сгруппированными данными (например, подсчёт – COUNT(\*))
В MongoDB для агрегации используется метод aggregate(). Данный метод имеет следующий синтаксис
Допустим, что нам необходимо вычислить общую зарплату всех разработчиков в коллекции. Для этого мы можем использовать следующий запрос:

> db.developers.aggregate( [ {$group :{ _id : "Developers", total_salary: { $sum : "$salary" }}} ] )

{ "\_id" : "Developers", "total_salary" : 10500 }

# $sum Суммирует указанные значения всех документов в коллекции

db.developers.aggregate([
{$group : {_id : “$title”,
total_salary : {$sum : “$salary”}}}
])

$avg Рассчитывает среднее значение указанного поля поля для всех документов коллекции.
db.developers.aggregate([
 {$group : {\_id : “$title”,
 avg_salary : {$avg : “$salary”}}}
 ])
$min Получает минимальное значение указанного поля документа в коллекции
db.developers.aggregate([
{$group : {_id : “$title”,

min_salary : {$min : “$salary”}}}])

### $max Получает максимальное значение указанного поля документа в коллекции

db.developers.aggregate([
{$group : {_id : “$title”,
max_salary : {$max : “$salary”}}}])

### $push Вставляет значение в массив в результирующем документе

db.developers.aggregate([
{$group : {_id : “$title”,
skills : {$push: “$skills”}}}])

### $addToSet Вставляет значение в массив в результирующем документе, но не создаёт дубликаты

db.developers.aggregate([
{$group : {_id : “$title”,
skills : {$addToSet : “$skills”}}}])

### $first Получает первый документ из сгруппированных. Обычно используется вместе с сортировкой

db.developers.aggregate([
{$group : {_id : “$title”,
first_skill : {$first : “$skills”}}}])

### $last Получает крайний документ из сгруппированных. Обычно используется вместе с сортировкой

db.developers.aggregate([
{$group : {_id : “$title”,
last_skill : {$last : “$skills”}}}])

### $project

Используется для выбора некоторых специальных полей из коллекции.

### $match

Операция фильтрации, которая может уменьшить количество документов, которые передаются для ввода в следующий этап.

### $group

Непосредственно, сама агрегация

### $sort

Сортирует документы

### $skip

С помощью данной команды мы можем проигнорировать список документов в имеющемся множестве.

### $limit

Ограничивает количество документов для вывода на количество, переданное методу, начиная, с текущей позиции.
$unwind
Используется для “разматывания” документов, который используют массивы.
